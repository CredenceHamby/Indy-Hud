{"slots":{"0":{"name":"core","type":{"events":[],"methods":[]}},"1":{"name":"slot2","type":{"events":[],"methods":[]}},"2":{"name":"slot3","type":{"events":[],"methods":[]}},"3":{"name":"slot4","type":{"events":[],"methods":[]}},"4":{"name":"slot5","type":{"events":[],"methods":[]}},"5":{"name":"slot6","type":{"events":[],"methods":[]}},"6":{"name":"slot7","type":{"events":[],"methods":[]}},"7":{"name":"slot8","type":{"events":[],"methods":[]}},"8":{"name":"slot9","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-3":{"name":"player","type":{"events":[],"methods":[]}},"-2":{"name":"construct","type":{"events":[],"methods":[]}},"-4":{"name":"system","type":{"events":[],"methods":[]}},"-5":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"maxDist = 90 --export: Maximum render distance in meters, 90 recommended\nmaxPerFrame = 400 --export: Units drawn per render frame, 400 max recommended\n\nlocal a,b,c,d,e,f=system.print,string.format,math.floor,math.max,math.min,table.concat;local g=16777216;local function h(i)local j=i.x*Industry.cx;local k=i.y*Industry.cy;local l=i.z*Industry.cz;return j+k+l+Industry.worldPos end;local function m(n)return n==math.huge or n==-math.huge end;local function o(p,q)local r=10^(q or 0)return c(p*r+0.5)/r end;local function s(t)if t==nil or t~=t or t<1 or type(t)~=\"number\"then return\"00:00:00\"end;local u=c(t/3600)t=t-3600*u;local e=c(t/60)t=t-60*e;local v=o(t,0)local w=b(\"%02d:%02d:%02d\",u,e,v)return w end;local function x(y,z)return y.dist<z.dist end;Industry=(function()local A={i=0,cx=vec3(construct.getWorldOrientationRight()),cy=vec3(construct.getWorldOrientationForward()),cz=vec3(construct.getWorldOrientationUp()),ready=false,states={'STOPPED','RUNNING','NEEDS INGREDIENTS','OUTPUT FULL','NO OUTPUT LINK','PENDING','MISSING SCHEMATIC','SERVER ERROR'},allBlocks={},renderBlocks={},elemIndy={},sortedIndy={},totalUnits=0,totalUnrender=0,lastFilter='r',searchActive=false,searches={},filters={1,1,1,1,1,1,1,1},cssBase=\"\"}function A.getCSS(B)B.cssBase=[[ <style> .ar-olay{position:fixed; top:0vh; left:0vw; height:100vh; width:100vw;} .indy{ position: absolute; display: block; color: #222; font-size: 0.89vh; opacity: 0.6; width: 18vh; text-transform:uppercase; } .fs-s{font-size:0.85em;} .bg-b .ii{background:#303030; color:#fff;} .grow{flex-grow:1;} .ii-row{display: flex;} .ii{display:inline-block; padding: 0.2rem 0.3rem; margin:0.08rem; margin-left:0; background:#eee;} .ib{border:1px solid #eee; color:#fff;} .ii-dist, .ii-indy{display:inline-block; transform: skew(-15deg); font-weight:900;} .ii-state{color:#fff;} .state-red{background:#892e2e;} .state-green{background:#338f47;} .state-orange{background:#958122;} .ii-tier{color:#fff;} .ii.tier-X{background:#666;} .ii.tier-1{background:#5494f7;} .ii.tier-2{background:#2977ef;} .ii.tier-3{background:#06f;} .ii.tier-4{background:#0152cd;} .ii.tier-5{background:#003991;} .ii-scale{} .ii-name{white-space: nowrap; overflow: hidden; text-overflow: ellipsis;} div.sks{padding:0.4em 0.5em; margin-top:0.5em; background:#3473BA; color:#fff; font-size:1.1em;} .legend{position:absolute; left:2vw; top:34.5vh; background:#fff; opacity:0.85; font-size:0.88vh; color:#222; z-index:999;} .legend h2{font-size:0.91vh; margin:0 0 0.2em 0; padding:0.15em 0.6em; background:#3473BA; color:#fff; font-weight:400;} p{color:#666; font-size:0.95em; padding:0em 0.3em; margin:0.2em 0.6em 0 0.6em; border-left:0.5em solid #3473BA;} ul{list-style:none; margin:0; padding:0.3em 0 0.2em 0;} ul li{margin-bottom:0.3em; padding:0.2em 0.6em;} li strong{background:#555; color:#f1f1f1; padding:0.2em 0.3em; margin-right:0.4em;} li span{background:#e1e1e1; color:#555; padding:0.2em 0.3em; margin-right:0.4em;} .svg{display:inline-block;} svg{width:100%;} svg,.svg{margin:0; padding:0;} li.]]..B.lastFilter..[[{background:#3473BA !important; color:#fff;} ]]..(B.searchActive and\"li.f1{background:#3473BA !important; color:#fff;}\"or\"\")..[[ </style> <div class=\"legend\"> <div class=\"svg\"><svg version=\"1.1\" viewBox=\"0 0 1024 84\" xml:space=\"preserve\"> <style type=\"text/css\"> .st0{fill:#3473BA;} .st1{fill:#FFFFFF;} .st2{font-family:'BankGothic';} .st3{font-size:46.69px; text-transform:uppercase;} </style> <rect class=\"st0\" width=\"100%\" height=\"90\"/> <g> <path class=\"st1\" d=\"M41.2,37.2c2.9-0.2,5.8,1,7.5,3.4c1.3,1.7,3.7,2.1,5.4,0.8c0,0,0.1,0,0.1-0.1l2.9-2.3c1.7-1.3,2-3.7,0.7-5.3 c-6.6-8.7-19.1-10.5-27.8-3.8s-10.5,19.1-3.8,27.8c3.7,4.9,9.6,7.9,15.8,7.9c4.3-0.1,8.5-1.5,12.1-4.1c5.1-3.5,10.2-9,19.9-16 c-4.2,1.1-8.4,2.4-12.5,4c-6.6,2.3-13.9,4.8-19.5,4.7c-4.7,0-8.5-3.8-8.5-8.5C33.5,41.2,36.9,37.5,41.2,37.2L41.2,37.2z\"/> <path class=\"st1\" d=\"M87,54.1c-2.9,0.2-5.8-1-7.5-3.4c-1.3-1.7-3.7-2.1-5.4-0.8c0,0-0.1,0-0.1,0.1l-2.9,2.3c-1.7,1.3-2,3.7-0.7,5.3 c6.6,8.8,19.1,10.5,27.8,3.9s10.5-19.1,3.9-27.8c-3.8-5-9.6-7.9-15.9-7.9c-4.3,0.1-8.5,1.5-12.1,4.1c-5.1,3.5-10.2,9-19.9,16 c4.2-1.1,8.4-2.4,12.5-4c6.6-2.3,13.9-4.8,19.5-4.7c4.7,0.2,8.3,4.2,8.1,8.8C94.2,50.2,91.1,53.6,87,54.1z\"/> </g> <text transform=\"matrix(1 0 0 1 126.19 57.85)\" class=\"st1 st2 st3\">Infinity Corporation</text> </svg></div> <h2>LUA TAB COMMANDS</h2> <p>TOTAL MACHINES: ]]..B.totalUnits..[[</p> <p>NOT RENDERED: ]]..B.totalUnrender..[[</p> <p>Search filters will stack until reset with R</p> <ul> <li class=\"a1\"><strong>A:1</strong><span>show 1</span>Stopped</li> <li class=\"a2\"><strong>A:2</strong><span>show 2</span>Running</li> <li class=\"a3\"><strong>A:3</strong><span>show 3</span>Miss Ingredients</li> <li class=\"a4\"><strong>A:4</strong><span>show 4</span>Output Full</li> <li class=\"a5\"><strong>A:5</strong><span>show 5</span>No Container Link</li> <li class=\"a6\"><strong>A:6</strong><span>show 6</span>Pending</li> <li class=\"a7\"><strong>A:7</strong><span>show 7</span>Miss Schematics</li> <li class=\"a8\"><strong>A:8</strong><span>show 8</span>Server Error Issue</li> <li class=\"a9\"><strong>A:9</strong><span>show errors</span>All Error Codes</li> <li class=\"r\"><strong>R</strong><span>show all</span>Reset All Filters</li> <li class=\"f1\"><span>find pure</span>Search For Output Products</li> <li class=\"f1\"><span>find assembly</span>Search By Machine Type</li> </ul> <div class=\"sks\">]]..f(B.searches,', ')..[[</div> </div> ]]end;function A.getARxy(B,C)local D=h(C.pos)local t={D.x,D.y,D.z}return library.getPointOnScreen(t)end;function A.sortItems(B)table.sort(B.sortedIndy)end;function A.filter(B,t)if t=='errors'then B.lastFilter='a9'for E,F in ipairs(B.filters)do B.filters[E]=0 end;B.filters[3]=1;B.filters[4]=1;B.filters[5]=1;B.filters[7]=1;B.filters[8]=1 elseif t=='all'then B.lastFilter='r'B.searchActive=false;B.searches={}for E,F in ipairs(B.filters)do B.filters[E]=1 end elseif type(t/1)=='number'then B.lastFilter='a'..t;for E,F in ipairs(B.filters)do B.filters[E]=0 end;B.filters[t/1]=1 end end;function A.find(B,t)B.searchActive=true;local G=t:lower()B.searches[#B.searches+1]=G end;function A.init(B)B.curTime=system.getArkTime()B.worldPos=vec3(construct.getWorldPosition())local H=core.getElementIdList()local I={}local J={}local K=''B.fuelComps={}for E=1,#H,1 do local L={uid=H[E],class=core.getElementClassById(H[E]),state=1,schemLeft=0,unitsDone=0,batchTotal=0,batchLeft=0,maintainTotal=0,maintainDone=0,products={}}if L.class:lower():sub(1,8)=='industry'then L.name=core.getElementNameById(H[E])L.kind=core.getElementDisplayNameById(H[E])L.class=core.getElementClassById(H[E])L.pos=vec3(core.getElementPositionById(H[E]))I['uid'..L.uid]=L else end end;B.elemIndy=I;system.showScreen(1)system.setScreen(\"\")B.Renderer=coroutine.create(B.render)B.Processor=coroutine.create(B.update)B.ready=true end;function A.makeRender(B,C)if not B.ready then return\"\"end;if B.filters[C.state]==0 then return\"\"end;local M=B:getARxy(C)local N=M[2]*100;local O=M[1]*100;if O>90 or O<1 or(N>95 or N<1)then return\"\"end;C.dist=M[3]local P=utils.clamp((75-M[3])/70*1.2,0.7,1.0)local Q=1;Q=100-C.dist*10;local R=\"\"R=(100-C.dist/2-35)/100;local S=78;S=S+55*(maxDist-C.dist)/maxDist;S=S/100;local T='red'if C.state==2 then T='green'end;if C.state==6 or C.state==1 then T='orange'end;local U='X'local P='-'local V=\"No selection\"local W=C.schemLeft and\"SCHEMS: \"..C.schemLeft or\"-\"if C.mainProduct and C.mainProduct.name then U=C.mainProduct.tier;P=C.mainProduct.scale;if P==''or not P then P='-'end;V=C.mainProduct.name end;local X=true;if B.searchActive then for E,G in ipairs(B.searches)do if V==\"No selection\"or V:lower():find(G)==nil and C.kind:lower():find(G)==nil then X=false end end end;if not X then return\"\"end;local Y=false;if N>49 and N<52 and O>48 and O<50 then R=1;Q=300-C.dist*10;Y=true end;local K=\"\"if C.dist<17 or C.dist<=maxDist and Y==true then Q=200-C.dist*10;R=R+0.3;Q=math.floor(Q)local Z=s(C.timeLeft)local _=\"NA\"if C.batchTotal>0 then _=\"BATCHES: \"..C.batchLeft..\" / \"..b(\"%.0f\",C.batchTotal)elseif C.maintainTotal>0 then _=\"MAINTAIN: \"..C.maintainDone..\" / \"..b(\"%.0f\",C.maintainTotal)end;K=[[ <div class=\"indy\" style=\"z-index:]]..Q..[[; opacity:]]..R..[[; top: ]]..M[2]*100 ..[[vh; left: ]]..M[1]*100 ..[[vw;\"> <div class=\"ii-row fs-s bg-b\"> <div class=\"ii ii-dist\">]]..b(\"%.0f\",M[3])..[[m</div><div class=\"ii ii-indy\">]]..C.name..[[</div> </div> <div class=\"ii-row\"> <div class=\"ii ii-state state-]]..T..[[ grow\">]]..B.states[C.state]..[[</div> </div> ]]K=K..[[ <div class=\"ii-row bg-g\"> <div class=\"ii ii-tier tier-]]..U..[[\">]]..U..[[</div><div class=\"ii ii-scale scale-l\">]]..P..[[</div><div class=\"ii ii-name grow\">]]..V..[[</div> </div> <div class=\"ii-row fs-s\"> <div class=\"ii grow\">]].._..[[</div><div class=\"ii\">]]..W..[[</div> </div> ]]K=K..\"</div>\"else if C.dist>maxDist then K=\"\"else R=d(R,0.35)K=[[ <div class=\"indy\" style=\"z-index:]]..Q..[[; opacity:]]..R..[[; top: ]]..M[2]*100 ..[[vh; left: ]]..M[1]*100 ..[[vw; transform:scale(]]..S..[[);\"> <div class=\"ii ib state-]]..T..[[\">]]..b(\"%.0f\",M[3])..[[m</div> </div> ]]end end;return K end;function A.compile(B)end;function A.coRender(B)local a0=coroutine.status(B.Renderer)if a0~=\"dead\"then local a1,a2=coroutine.resume(B.Renderer)if a2 then system.print(\"ERROR: \"..a2)end elseif a0==\"dead\"then B.Renderer=coroutine.create(B.render)local a1,a2=coroutine.resume(B.Renderer)end end;function A.render()local B=Industry;B:getCSS()B.renderBlocks={}B.renderBlocks[1]=B.cssBase;local E=1;for a3,C in pairs(B.elemIndy)do local a4=B:makeRender(C)if a4~=\"\"then E=E+1;B.renderBlocks[E]=a4 end;if math.fmod(E,maxPerFrame)==0 then coroutine.yield()end end;local a5=#B.renderBlocks-1;B.totalUnrender=B.totalUnits-a5;local K=table.concat(B.renderBlocks)system.setScreen(K)end;function A.coUpdate(B)local a0=coroutine.status(B.Processor)if a0~=\"dead\"then local a1,a2=coroutine.resume(B.Processor)if a2 then system.print(\"ERROR: \"..a2)end elseif a0==\"dead\"then B.Processor=coroutine.create(B.update)local a1,a2=coroutine.resume(B.Processor)end end;function A.update()local B=Industry;local a6=0;for a7,C in pairs(B.elemIndy)do local a8=core.getElementIndustryInfoById(C.uid)if not a8 then a(C.uid..' had no data')coroutine.yield()else C.state=a8.state;C.schemLeft=a8.schematicsRemaining;C.unitsDone=a8.unitsProduced;C.batchTotal=a8.batchesRequested;C.batchLeft=a8.batchesRemaining;C.maintainTotal=a8.maintainProductAmount;C.maintainDone=a8.currentProductAmount;C.products=a8.currentProducts;C.timeLeft=a8.remainingTime;C.mainProduct={}if C.maintainDone>=g then C.maintainDone=c(C.maintainDone/g)end;if#C.products>0 then C.mainProduct=C.products[1]local a9=system.getItem(C.mainProduct.id)C.mainProduct.name=a9.locDisplayName;C.mainProduct.fullname=a9.displayNameWithSize;C.mainProduct.type=a9.type;C.mainProduct.tier=a9.tier;C.mainProduct.scale=a9.size;C.mainProduct.icon=a9.iconPath;coroutine.yield()end end;a6=a6+1;if#C.products<1 then coroutine.yield()end end;B.totalUnits=a6 end;return A end)()Commands=(function()local A={active=false,label='Listen to Voice',timed=0,lastCMD='',list={show={desc=' [1 to 9, show specific message matches]',fn=function(B,aa)local t=aa[2]Industry:filter(t)end},find={desc=' [search key, find machines or outputs]',fn=function(B,aa)local ab=table.remove(aa,1)local F=table.concat(aa,' ')Industry:find(F)end}}}function A.init(B)B.helps={}for aa,ac in pairs(B.list)do if ac.desc then ac.name=aa;B.helps[#B.helps+1]=aa end end;table.sort(B.helps)end;function A.key(B,ad)local a7=ad:sub(7,8)local type=ad:sub(1,6)if a7=='9'then B:call('show errors')elseif ad=='r'then B:call('show all')elseif type=='option'then B:call('show '..a7)end end;function A.help(B)a('-------------------------')a('- INDY HUD BY CODEINFUSED')a('- COMMANDS')for E,ae in ipairs(B.helps)do a(ae..B.list[ae].desc)end;a('-------------------------')end;function A.call(B,af,ag)local aa={}for C in af:gmatch(\"%S+\")do table.insert(aa,C)end;local t=string.lower(aa[1])if t=='help'then B:help()elseif B.list[t]then B.list[t].fn(B,aa,ag)end end;return A end)()Industry:init()Commands:init()Commands:help()","filter":{"args":[],"signature":"onStart()","slotKey":"-1"},"key":"0"},{"code":"Industry:coUpdate()\nIndustry:coRender()","filter":{"args":[],"signature":"onUpdate()","slotKey":"-4"},"key":"1"},{"code":"Commands:call(text)","filter":{"args":[{"variable":"*"}],"signature":"onInputText(text)","slotKey":"-4"},"key":"2"},{"code":"if action:sub(1,6)=='option' then\n  Commands:key(action)\nelseif action=='speedup' then\n  Commands:key('r')\nend","filter":{"args":[{"variable":"*"}],"signature":"onActionStart(action)","slotKey":"-4"},"key":"3"}],"methods":[],"events":[]}